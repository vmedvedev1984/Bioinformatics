ОПИСАНИЕ
Samtools — это набор утилит для работы с выравниваниями в форматах SAM (Sequence Alignment/Map), BAM и CRAM. 
Он конвертирует данные между форматами, выполняет сортировку, слияние и индексацию, а также может быстро извлекать данные из любых регионов.
Samtools предназначен для работы с потоком. Входной файл `-' он рассматривает как стандартный ввод (stdin), а выходной файл `-' — как стандартный вывод (stdout).
Таким образом, некоторые команды можно комбинировать с конвейерами Unix. Samtools всегда выводит предупреждения и сообщения об ошибках в стандартный поток ошибок (stderr).
Samtools также может открывать файлы на удалённых FTP- или HTTP(S)-серверах, если имя файла начинается с `ftp://', `http://' и т. д. 
Samtools проверяет текущий рабочий каталог на наличие индексного файла и загружает его при его отсутствии. 
Samtools не загружает файл выравнивания целиком, если ему не было предоставлено соответствующее разрешение.
Если требуется индекс, samtools ищет суффикс индекса, добавленный к имени файла, и, если он не найден, повторяет попытку без суффикса (например, in.bam.bai , а затем in.bai ). 
Однако, если индекс находится в совершенно другом месте или имеет другое имя, можно вставить как имя основного файла данных, так и имя файла индекса вместе с помощью 

##idx## 

Например, для явного указания местоположения файлов данных и индекса можно использовать 

/data/in.bam##idx##/indices/in.bam.bai

КОМАНДЫ
У каждой команды есть своя страница руководства, которую можно просмотреть, например, с помощью man samtools-view или с помощью последней версии руководства GNU man, используя man samtools view . 
Ниже приведен краткий обзор синтаксиса и описание подкоманд.
Общие для всех подкоманд параметры описаны ниже в разделе ГЛОБАЛЬНЫЕ ПАРАМЕТРЫ КОМАНД.

view          samtools view [ параметры ] in.sam | in.bam | in.cram [ регион ...]
              Если не указаны параметры или регионы, выводит все выравнивания в указанном входном файле выравнивания (в формате SAM, BAM или CRAM) на стандартный вывод в формате SAM (по умолчанию без заголовка).
              Вы можете указать одну или несколько спецификаций регионов, разделённых пробелами, после имени входного файла, чтобы ограничить вывод только теми выравниваниями, которые перекрывают указанные регионы. 
              Для использования спецификаций регионов требуется отсортированный по координатам и индексированный входной файл.
              Существуют опции для изменения выходного формата с SAM на BAM или CRAM, поэтому эта команда также действует как утилита преобразования формата файла.


tview         samtools tview [ -p chr:pos ] [ -s STR ] [ -d display ] <in.sorted.bam> [ref.fasta]
              Средство просмотра выравнивания текста (на основе библиотеки ncurses). 
              В средстве просмотра нажмите «?» для получения справки и нажмите «g», чтобы проверить начало выравнивания с области в формате, например, «chr10:10 000 000» или «=10 000 000» при просмотре той же последовательности ссылок.


quickcheck    samtools quickcheck [ options ] in.sam | in.bam | in.cram [ ... ]
              Быстрая проверка целостности входных файлов. 
              Проверяет наличие в начале файла допустимого заголовка (для всех форматов), содержащего хотя бы одну целевую последовательность, а затем ищет конец файла и проверяет наличие и целостность символа конца файла (EOF) (только BAM).
              Данные в середине файла не считываются, так как это заняло бы гораздо больше времени, поэтому учтите, что эта команда не обнаружит внутренние повреждения, но она полезна для проверки того, что файлы не усекаются, перед выполнением над ними более трудоемких задач.
              Эта команда завершится с ненулевым кодом выхода, если у какого-либо входного файла нет допустимого заголовка или отсутствует блок EOF. В противном случае команда завершится успешно (с нулевым кодом выхода).


checksum      samtools checksum [ параметры ] in.sam | in.bam | in.cram
              Функция samtools checksum создаёт контрольную сумму на основе CRC32 для данных, содержащихся в BAM-файле. 
              Она может быть независимой от порядка и ориентации для проверки всех данных секвенирования, прошедших весь конвейер от FASTQ до выравнивания и сортировки, или учитывать полную информацию о выравнивании и порядке для проверки преобразований форматов и обработки данных файла.


head          samtools head [ options ] in.sam | in.bam | in.cram
              Выводит заголовки входного файла и, при необходимости, первые несколько записей выравнивания. 
              Эта команда всегда отображает заголовки в том виде, в котором они находятся в файле, никогда не добавляя дополнительный заголовок @PG.


index         samtools index [ -bc ] [ -m INT ] aln.sam.gz | aln.bam | aln.cram [ out.index ]
              Индексируйте файлы SAM, BAM или CRAM, отсортированные по координатам, для быстрого произвольного доступа. 
              Обратите внимание, что для SAM это работает только после предварительного сжатия файла с помощью BGZF. 
              (Начиная с версии Samtools 1.16, этой команде также можно задать несколько имён файлов выравнивания, которые индексируются по отдельности.)
              Этот индекс необходим, когда аргументы региона используются для ограничения представления samtools и аналогичных команд определенными интересующими регионами.
              Если указано имя выходного файла, индексный файл будет записан в out.index . 
              В противном случае для CRAM-файла aln.cram будет создан индексный файл aln.cram.crai ; для BAM- или SAM-файла aln.bam будет создан либо aln.bam.bai , либо aln.bam.csi , в зависимости от выбранного формата индекса.


sort          samtools sort [ -l level ] [ -m maxMem ] [ -o out.bam ] [ -O format ] [ -n ] [ -t tag ] [ -T tmpprefix ] [ -@ threads ] [ in.sam | in.bam | in.cram ]
              Сортировка выравниваний по крайней левой координате или по имени чтения при использовании -n . При необходимости будет добавлен соответствующий заголовок порядка сортировки @HD-SO или обновлен существующий.
              Отсортированный вывод по умолчанию записывается в стандартный вывод или в указанный файл ( out.bam ) при использовании опции -o . 
              Эта команда также создаст временные файлы tmpprefix . %d .bam при необходимости, когда все данные выравнивания не помещаются в память (что регулируется опцией -m ).
              Если вам нужны данные, упорядоченные по именам, без полной лексикографической сортировки, рассмотрите возможность использования samtools collate .
              Обратите внимание, что если отсортированный выходной файл требуется индексировать с помощью samtools index , необходимо использовать сортировку по координатам по умолчанию. Таким образом, параметры -n и -t несовместимы с samtools index .


collate       samtools collate [ параметры ] in.sam | in.bam | in.cram [ <префикс> ]
              Перемешивает и группирует чтения по именам. Collate — более быстрая альтернатива полной сортировке по именам запросов. 
              Функция гарантирует, что чтения с одинаковым именем будут сгруппированы в смежные группы, но не гарантирует порядок имён чтений в группах.
              Вывод этой команды должен подходить для любой операции, требующей группировки всех считываний из одного шаблона.


cram-size     samtools cram-size [ параметры ] in.cram
              Выводит сводку идентификаторов содержимого блоков CRAM и связанных с ними серий данных, хранящихся в них. 
              Более подробную информацию о кодировке каждой серии данных в каждом контейнере можно получить с помощью параметра -e или --encodings .


idxstats      samtools idxstats in.sam | in.bam | in.cram
              Извлечь и вывести статистику из индексного файла, соответствующего входному файлу. 
              Перед вызовом idxstats входной BAM-файл должен быть проиндексирован с помощью samtools index.
              При запуске с файлом SAM или CRAM, а также с неиндексированным файлом BAM эта команда всё равно выдаст ту же сводную статистику, но при этом будет прочитан весь файл. 
              Это значительно медленнее, чем использование индексов BAM.
              Вывод разграничен табуляцией, каждая строка содержит имя последовательности, длину последовательности, количество сопоставленных и количество не сопоставленных прочтений. 
              Вывод выводится в стандартный вывод (stdout).


flagstat      samtools flagstat in.sam | in.bam | in.cram
              Выполняет полный проход по входному файлу для расчета и вывода статистики на стандартный вывод.
              Предоставляет данные по каждой из 13 категорий, основанные, главным образом, на битовых флагах в поле FLAG. 
              Каждая категория в выходных данных подразделяется на «пройдено» и «не пройдено», что отображается как «#ПРОШЕЛ + #НЕ ПРОШЕЛ» с последующим описанием категории.


flags         flags samtools INT | STR [,...]
              Преобразование между текстовым и числовым представлением флага.

              ФЛАГИ:

              0x1	PAIRED	технология парного (или многосегментного) секвенирования
              0x2	PROPER_PAIR	каждый сегмент правильно выровнен в соответствии с элайнером
              0x4	UNMAP	сегмент не отображен
              0x8	MUNMAP	следующий сегмент в шаблоне не сопоставлен
              0x10	REVERSE	SEQ обратно дополняема
              0x20	MREVERSE	SEQ следующего сегмента в шаблоне обратно дополняется
              0x40	READ1	первый сегмент в шаблоне
              0x80	READ2	последний сегмент в шаблоне
              0x100	SECONDARY	вторичное выравнивание
              0x200	QCFAIL	не прошедший контроль качества
              0x400	DUP	ПЦР или оптический дубликат
              0x800	SUPPLEMENTARY	дополнительное выравнивание

stats         samtools bedcov [options] region.bed in1.sam|in1.bam|in1.cram[...]
              samtools stats собирает статистику из BAM-файлов и выводит её в текстовом формате. 
              Результаты можно визуализировать графически с помощью plot-bamstats.



bedcov        samtools bedcov [options] region.bed in1.sam|in1.bam|in1.cram[...]
              Сообщает общее количество баз прочтений (т.е. сумму глубин прочтений на одно основание) для каждого геномного региона, указанного в предоставленном файле BED. 
              Регионы выводятся в том виде, в котором они представлены в файле BED, с нулевой отметкой. 
              Количество баз для каждого предоставленного файла выравнивания отображается в отдельных столбцах.


depth         samtools depth [options] [in1.sam|in1.bam|in1.cram [in2.sam|in2.bam|in2.cram] [...]]
              Вычисляет глубину чтения в каждой позиции или области.


ampliconstats samtools ampliconstats [ параметры ] primers.bed in.sam | in.bam | in.cram [...]
              Samtools ampliconstats собирает статистику из одного или нескольких входных файлов выравнивания и создает таблицы в текстовом формате. 
              Результаты можно визуализировать графически с помощью plot-ampliconstats.
              Файлы выравнивания должны быть предварительно вырезаны из последовательности праймеров, например, с помощью samtools ampliconclip , а сайты этих праймеров должны быть указаны в качестве файла bed в аргументах.


mpileup       samtools mpileup [ -EB ] [ -C capQcoef ] [ -r reg ] [ -f in.fa ] [ -l list ] [ -Q minBaseQ ] [ -q minMapQ ] in.bam [ in2.bam [ ... ]]
              Генерация текстового наложения для одного или нескольких BAM-файлов. Для вывода в форматах VCF и BCF используйте команду bcftools mpileup . 
              Записи выравнивания группируются по идентификаторам образцов (SM) в строках заголовка @RG. 
              Если идентификаторы образцов отсутствуют, каждый входной файл рассматривается как один образец.
              Описание формата и параметров pileup см. на странице руководства samtools-mpileup.


consensus     samtools consensus [ параметры ] in .bam

Генерация консенсуса из файла SAM, BAM или CRAM на основе содержимого записей выравнивания. Консенсус записывается в формате FASTA, FASTQ или формате, ориентированном на совмещение.

Выходные данные по умолчанию для форматов FASTA и FASTQ включают одно основание на консенсус без пробелов. Таким образом, вставки относительно выровненного референса будут включены, а делеции удалены. Это поведение можно настроить.

Предлагаются два алгоритма определения консенсуса. По умолчанию гетерозиготный консенсус вычисляется байесовским методом, основанным на алгоритме консенсуса «Gap5». Также доступен более простой метод подсчёта базовой частоты.



ссылка
Справочник samtools [ параметры ] в .bam

Сгенерировать ссылку из файла SAM, BAM или CRAM на основе содержимого поля SEQuence и вспомогательных тегов MD:Z: или из встроенных блоков ссылок в файле CRAM (при условии, что он был создан с использованием опции embed_ref=1 ).


охват
покрытие samtools [ параметры ] [ in1.sam | in1.bam | in1.cram [ in2.sam | in2.bam | in2.cram ] [...]]

Создает гистограмму или таблицу покрытия по хромосомам.


слияние
samtools merge [ -nur1f ] [ -h inh.sam ] [ -t tag ] [ -R reg ] [ -b list ] out.bam in1.bam [ in2.bam in3.bam ... inN.bam ]

Объединить несколько отсортированных файлов выравнивания, создав один отсортированный выходной файл, содержащий все входные записи и сохраняющий существующий порядок сортировки.

Если указано -h , заголовки @SQ входных файлов будут объединены в указанный заголовок, в противном случае они будут объединены в составной заголовок, созданный из входных заголовков. Если порядок заголовков @SQ отличается, может потребоваться пересортировка выходного файла после объединения.

Порядок записей во входных файлах должен соответствовать использованию параметров командной строки -n и -t . В противном случае порядок вывода будет неопределён. Подробнее о порядке записей см. в разделе sort.


расколоть
samtools split [ параметры ] merged.sam | merged.bam | merged.cram

Разделяет файл по группам чтения, создавая один или несколько выходных файлов, соответствующих общему префиксу (по умолчанию на основе имени входного файла), каждый из которых содержит одну группу чтения.


кот
samtools cat [ -b список ] [ -h заголовок.sam ] [ -o выход.bam ] in1.bam in2.bam [ ... ]

Объединить BAM- и CRAM-файлы. Хотя это работает как с BAM-, так и с CRAM-файлами, все входные файлы должны иметь одинаковый формат. Словарь последовательностей каждого входного файла должен быть идентичным, хотя эта команда это не проверяет. Эта команда использует приём, аналогичный reheader , что обеспечивает быструю конкатенацию BAM-файлов.


импорт
samtools import [ options ] in.fastq [ ... ]

Преобразует один или несколько файлов FASTQ в невыровненные файлы SAM, BAM или CRAM. Эти форматы предоставляют расширенные возможности отслеживания метаданных выборки через заголовок SAM и метаданных по чтению через вспомогательные теги. Для обратного преобразования можно использовать команду fastq .


fastq/a
samtools fastq [ options ] in.bam
samtools fasta [ options ] in.bam

Преобразует BAM или CRAM в формат FASTQ или FASTA в зависимости от вызванной команды. Файлы будут автоматически сжаты, если их имена имеют расширение .gz, .bgz или .bgzf.

Входные данные для этой программы должны быть отсортированы по имени. Для этого используйте samtools collate или samtools sort -n .


faidx
samtools faidx <ref.fasta> [регион1 [...]]

Индексирует последовательность ссылок в формате FASTA или извлекает подпоследовательность из индексированной последовательности ссылок. Если область не указана, faidx индексирует файл и создаёт файл <ref.fasta>.fai на диске. Если области указаны, подпоследовательности будут извлечены и выведены на стандартный вывод в формате FASTA.

Входной файл может быть сжат в формат BGZF .

Файлы FASTQ можно читать и индексировать с помощью этой команды. Без использования --fastq любая извлечённая подпоследовательность будет в формате FASTA.


fqidx
samtools fqidx <ref.fastq> [region1 [...]]

Индексировать последовательность ссылок в формате FASTQ или извлекать подпоследовательность из индексированной последовательности ссылок. Если область не указана, fqidx проиндексирует файл и создаст файл <ref.fastq>.fai на диске. Если области указаны, подпоследовательности будут извлечены и выведены на стандартный вывод в формате FASTQ.

Входной файл может быть сжат в формат BGZF .

samtools fqidx следует использовать только для файлов fastq с небольшим количеством записей. Попытка использовать его для файла, содержащего миллионы коротких последовательностей, создаст индекс почти такого же размера, как исходный файл, а поиск с использованием индекса будет очень медленным и потребует много памяти.


дикт
samtools dict ref.fasta | ref.fasta.gz

Создайте файл словаря последовательностей из файла fasta.


успокоился
samtools calmd [ -Eeubr ] [ -C capQcoef ] aln.bam ref.fasta

Сгенерируйте тег MD. Если тег MD уже существует, эта команда выдаст предупреждение, если сгенерированный тег MD отличается от существующего. По умолчанию выводится SAM.

Calmd также может читать и записывать CRAM-файлы, хотя в большинстве случаев это бесполезно, поскольку CRAM пересчитывает теги MD и NM «на лету». Единственное исключение — когда и входной, и выходной CRAM-файлы были созданы с опцией no_ref .


помощник
samtools fixmate [ -rpcm ] [ -O format ] in.nameSrt.bam out.bam

Заполните координаты сопряжения, ISIZE и флаги, связанные с сопряжением, из выравнивания, отсортированного по имени.


разметка
samtools markdup [ -l длина ] [ -r ] [ -s ] [ -T ] [ -S ] in.algsort.bam out.bam

Отметьте дубликаты выравниваний в файле с координатной сортировкой, пропущенном через samtools fixmate с опцией -m . Эта программа использует теги MC и ms, предоставляемые fixmate.


rmdup
samtools rmdup [-sS] <input.srt.bam> <out.bam>

Эта команда устарела. Вместо неё используйте markdup.


addreplacerg
samtools addreplacerg [ -r rg-line | -R rg-ID ] [ -m mode ] [ -l level ] [ -o out.bam ] in.bam

Добавляет или заменяет теги группы прочтений в файле.


перехедер
samtools reheader [ -iP ] in.header.sam in.bam

Замените заголовок в in.bam на заголовок в in.header.sam . Эта команда выполняется гораздо быстрее, чем замена заголовка преобразованием BAM→SAM→BAM.

По умолчанию эта команда выводит файл BAM или CRAM в стандартный поток вывода (stdout), но для файлов формата CRAM она может выполнять редактирование на месте, как чтение, так и запись в один и тот же файл. Проверка заголовка на валидность и пригодность для использования с данными последовательности не выполняется.


targetcut
samtools targetcut [ -Q minBaseQ ] [ -i inPenalty ] [ -0 em0 ] [ -1 em1 ] [ -2 em2 ] [ -f ref ] in.bam

Эта команда идентифицирует целевые регионы, анализируя непрерывность глубины считывания, вычисляет гаплоидные консенсусные последовательности целевых участков и выводит SAM, где каждая последовательность соответствует целевой области. При использовании опции -f применяется BAQ. Эта команда предназначена только для вырезания клонов фосмидов из пула фосмидов, секвенируемых при секвенировании [Ref. Kitzman et al. (2010)].


фаза
samtools фаза [ -AF ] [ -k len ] [ -b префикс ] [ -q minLOD ] [ -Q minBaseQ ] in.bam

Назовите и фазируйте гетерозиготные SNP.


депад
samtools depad [ -SsCu1 ] [ -T ref.fa ] [ -o output ] in.bam

Преобразует BAM, выровненный по дополненной ссылке, в BAM, выровненный по удаленной ссылке. Дополненная ссылка может содержать дословные основания "*", но основания "*" также учитываются при нумерации ссылок. Это означает, что вызов последовательности оснований, выровненный по ссылке "*", считается оператором сопоставления сигары ("M" или "X") (если вызов основания — "A", "C", "G" или "T"). После удаления основания ссылки "*" удаляются, и такие выровненные вызовы оснований становятся вставками. Аналогичные преобразования применяются для операций удаления и дополнения сигары.


ампликонклип
samtools ampliconclip [ -o выходной.файл ] [ -f файл статистики ] [ --soft-clip ] [ --hard-clip ] [ --both-ends ] [ --strand ] [ --clipped ] [ --fail ] [ --no-PG ] -b входной.файл

Клип считывает файл, совместимый с SAM, на основе данных из файла BED.


образцы
samtools examples [ -o out.file ] [ -i ] [ -T TAG ] [ -f refs.fasta ] [ -F refs_list ] [ -X ]

Печатает образцы из файлов выравнивания


перезагрузить
samtools reset [ -o ФАЙЛ ] [ -x / --remove-tag список_тегов ] [ --keep-tag список_тегов ] [ --reject-PG pgid ] [ --no-RG ] [ --no-PG ] [...]

Удаляет информацию о выравнивании из записей, создавая невыровненный файл SAM, BAM или CRAM. Флаги сбрасываются, теги заголовков обновляются или удаляются по мере необходимости, а вспомогательные теги удаляются или сохраняются по мере необходимости. Обратите внимание, что порядок сортировки не изменяется.
